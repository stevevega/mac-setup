{"uri":"file:///Users/vega/Code/huli/manager-web/src/library/HH/Util/Script/Trial/Maintenance.php","root":{"kind":0,"name":"","children":[{"kind":512,"name":"HH\\Util\\Script\\Trial","location":[12,0,12,31]},{"kind":1,"name":"CommunicationHandler","modifiers":4096,"location":[14,5,14,50],"associated":[{"kind":1,"name":"Communication\\Handler"}]},{"kind":1,"name":"DateTime","modifiers":4096,"location":[15,5,15,13],"associated":[{"kind":1,"name":"DateTime"}]},{"kind":1,"name":"MailTrial","modifiers":4096,"location":[16,5,16,30],"associated":[{"kind":1,"name":"HH\\Mail\\Service\\MailTrial"}]},{"kind":1,"name":"ChangePlanFlow","modifiers":4096,"location":[17,5,17,54],"associated":[{"kind":1,"name":"HH\\Subscription\\Flow\\ChangePlan"}]},{"kind":1,"name":"TerminateFlow","modifiers":4096,"location":[18,5,18,61],"associated":[{"kind":1,"name":"HH\\Subscription\\Flow\\InstantTermination"}]},{"kind":1,"name":"ITrial","modifiers":4096,"location":[19,5,19,27],"associated":[{"kind":1,"name":"HH\\Subscription\\ITrial"}]},{"kind":1,"name":"Plans","modifiers":4096,"location":[20,5,20,26],"associated":[{"kind":1,"name":"HH\\Subscription\\Plans"}]},{"kind":1,"name":"SubscriptionTag","modifiers":4096,"location":[21,5,21,43],"associated":[{"kind":1,"name":"HH\\Subscription\\Tag"}]},{"kind":1,"name":"SubscriptionTrial","modifiers":4096,"location":[22,5,22,47],"associated":[{"kind":1,"name":"HH\\Subscription\\Trial"}]},{"kind":1,"name":"TrialStatus","modifiers":4096,"location":[23,5,23,48],"associated":[{"kind":1,"name":"HH\\Subscription\\Trial\\Status"}]},{"kind":1,"name":"UserInstance","modifiers":4096,"location":[24,5,24,37],"associated":[{"kind":1,"name":"HH\\User\\Instance"}]},{"kind":1,"name":"Session","modifiers":4096,"location":[25,5,25,42],"associated":[{"kind":1,"name":"Huli\\Authentication\\App\\Fixed\\Session"}]},{"kind":1,"name":"Transaction","modifiers":4096,"location":[26,5,26,30],"associated":[{"kind":1,"name":"Huli\\Database\\Transaction"}]},{"kind":1,"name":"UserModel","modifiers":4096,"location":[27,5,27,28],"associated":[{"kind":1,"name":"Model\\User"}]},{"kind":1,"name":"UserSubscriptionModel","modifiers":4096,"location":[28,5,28,53],"associated":[{"kind":1,"name":"Model\\User\\Subscription"}]},{"kind":1,"name":"UserSubscriptionNotificationModel","modifiers":4096,"location":[29,5,29,78],"associated":[{"kind":1,"name":"Model\\User\\Subscription\\Notification"}]},{"kind":1,"name":"stdClass","modifiers":4096,"location":[30,5,30,13],"associated":[{"kind":1,"name":"stdClass"}]},{"kind":1,"name":"HH\\Util\\Script\\Trial\\Maintenance","location":[35,0,442,1],"description":"This class is in charge of handling trial maintenance","children":[{"kind":1024,"name":"DOWNGRADING","modifiers":1,"location":[40,18,40,45],"scope":"HH\\Util\\Script\\Trial\\Maintenance","value":"'DOWNGRADING'"},{"kind":1024,"name":"NOTIFYING","modifiers":1,"location":[41,18,41,41],"scope":"HH\\Util\\Script\\Trial\\Maintenance","value":"'NOTIFYING'"},{"kind":1024,"name":"SKIPPING_DONE","modifiers":1,"location":[42,18,42,49],"scope":"HH\\Util\\Script\\Trial\\Maintenance","value":"'SKIPPING DONE'"},{"kind":1024,"name":"SKIPPING","modifiers":1,"location":[43,18,43,39],"scope":"HH\\Util\\Script\\Trial\\Maintenance","value":"'SKIPPING'"},{"kind":1024,"name":"TERMINATING","modifiers":1,"location":[44,18,44,45],"scope":"HH\\Util\\Script\\Trial\\Maintenance","value":"'TERMINATING'"},{"kind":1024,"name":"UNKOWN","modifiers":1,"location":[45,18,45,35],"scope":"HH\\Util\\Script\\Trial\\Maintenance","value":"'UNKOWN'"},{"kind":1024,"name":"UPDATING_INTERCOM","modifiers":1,"location":[46,18,46,57],"scope":"HH\\Util\\Script\\Trial\\Maintenance","value":"'UPDATING INTERCOM'"},{"kind":16,"name":"$controller","modifiers":4,"location":[53,12,53,23],"scope":"HH\\Util\\Script\\Trial\\Maintenance","type":"HH\\Util\\Script\\Trial\\Object"},{"kind":16,"name":"$id_user","modifiers":4,"location":[59,12,59,20],"scope":"HH\\Util\\Script\\Trial\\Maintenance","type":"int"},{"kind":16,"name":"$test_mode","modifiers":4,"location":[66,12,66,22],"scope":"HH\\Util\\Script\\Trial\\Maintenance","type":"bool"},{"kind":32,"name":"__construct","modifiers":1,"location":[73,4,80,5],"scope":"HH\\Util\\Script\\Trial\\Maintenance","children":[{"kind":128,"name":"$controller","location":[73,32,73,43],"scope":"__construct","type":"mixed"},{"kind":128,"name":"$id_user","location":[73,45,73,57],"description":"user id for logging change_by fields","scope":"__construct","typeSource":1,"type":"int"},{"kind":128,"name":"$mode","location":[73,59,73,72],"scope":"__construct","typeSource":1,"type":"string"}]},{"kind":32,"name":"execute","modifiers":4,"location":[85,4,120,5],"description":"Execute maintenance","scope":"HH\\Util\\Script\\Trial\\Maintenance","typeSource":1,"type":"HH\\Util\\Script\\Trial\\void"},{"kind":32,"name":"process","modifiers":4,"location":[130,4,168,5],"description":"Trial ended state processor","scope":"HH\\Util\\Script\\Trial\\Maintenance","typeSource":1,"type":"bool","children":[{"kind":128,"name":"$sub","location":[130,29,130,55],"scope":"process","typeSource":1,"type":"Model\\User\\Subscription"},{"kind":128,"name":"$transaction","location":[130,57,130,81],"scope":"process","typeSource":1,"type":"Huli\\Database\\Transaction"}]},{"kind":32,"name":"process_grace_period","modifiers":4,"location":[178,4,191,5],"description":"Notifies the user that her account is now on a grace period, while in\nit, the user can still use HuliPractice but will be soon terminated.","scope":"HH\\Util\\Script\\Trial\\Maintenance","typeSource":1,"type":"bool","children":[{"kind":128,"name":"$sub","location":[178,42,178,68],"scope":"process_grace_period","typeSource":1,"type":"Model\\User\\Subscription"}]},{"kind":32,"name":"process_trial_over","modifiers":4,"location":[200,4,218,5],"description":"Notifies the user that her account free trial is over.","scope":"HH\\Util\\Script\\Trial\\Maintenance","typeSource":1,"type":"bool","children":[{"kind":128,"name":"$sub","location":[200,40,200,66],"scope":"process_trial_over","typeSource":1,"type":"Model\\User\\Subscription"}]},{"kind":32,"name":"process_termination","modifiers":4,"location":[228,4,241,5],"description":"Terminates the subscription and notifies the user.","scope":"HH\\Util\\Script\\Trial\\Maintenance","typeSource":1,"type":"bool","children":[{"kind":128,"name":"$sub","location":[228,41,228,67],"scope":"process_termination","typeSource":1,"type":"Model\\User\\Subscription"},{"kind":128,"name":"$transaction","location":[228,69,228,93],"scope":"process_termination","typeSource":1,"type":"Huli\\Database\\Transaction"}]},{"kind":32,"name":"proceed","modifiers":4,"location":[251,4,262,5],"description":"Returns whether the user has been previously notified for the\ncurrent subscription status.","scope":"HH\\Util\\Script\\Trial\\Maintenance","typeSource":1,"type":"bool","children":[{"kind":128,"name":"$sub","location":[251,29,251,55],"scope":"proceed","typeSource":1,"type":"Model\\User\\Subscription"}]},{"kind":32,"name":"terminate","modifiers":4,"location":[277,4,329,5],"description":"* Terminate account\n\n- If user has saas instance, then downgrade to free\n- if user has no saas instance, then unsubscribe (cancel) account","scope":"HH\\Util\\Script\\Trial\\Maintenance","typeSource":1,"type":"bool","children":[{"kind":128,"name":"$sub","location":[277,31,277,57],"scope":"terminate","typeSource":1,"type":"Model\\User\\Subscription"},{"kind":128,"name":"$transaction","location":[277,59,277,83],"scope":"terminate","typeSource":1,"type":"Huli\\Database\\Transaction"}]},{"kind":32,"name":"register_notification","modifiers":4,"location":[338,4,358,5],"description":"Register notification attempt","scope":"HH\\Util\\Script\\Trial\\Maintenance","typeSource":1,"type":"bool","children":[{"kind":128,"name":"$sub","location":[338,43,338,69],"scope":"register_notification","typeSource":1,"type":"Model\\User\\Subscription"}]},{"kind":32,"name":"get_trial_engine","modifiers":4,"location":[368,4,414,5],"description":"Returns the trial status engine to be used when determining the\nstatus of a subscription.","scope":"HH\\Util\\Script\\Trial\\Maintenance","typeSource":1,"type":"HH\\Subscription\\ITrial","children":[{"kind":128,"name":"$sub","location":[368,38,368,64],"scope":"get_trial_engine","typeSource":1,"type":"Model\\User\\Subscription"}]},{"kind":32,"name":"update_intercom","modifiers":4,"location":[421,4,425,5],"description":"Updates the user subscription status in intercom.","scope":"HH\\Util\\Script\\Trial\\Maintenance","typeSource":1,"type":"HH\\Util\\Script\\Trial\\void","children":[{"kind":128,"name":"$sub","location":[421,37,421,63],"scope":"update_intercom","typeSource":1,"type":"Model\\User\\Subscription"}]},{"kind":32,"name":"log","modifiers":4,"location":[433,4,441,5],"description":"Logs common states for the maintenance process.","scope":"HH\\Util\\Script\\Trial\\Maintenance","typeSource":1,"type":"HH\\Util\\Script\\Trial\\void","children":[{"kind":128,"name":"$msg","location":[433,25,433,36],"description":"steps description","scope":"log","typeSource":1,"type":"string"},{"kind":128,"name":"$sub","location":[433,38,433,64],"scope":"log","typeSource":1,"type":"Model\\User\\Subscription"}]}]}]}}