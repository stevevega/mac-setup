{"uri":"file:///Users/vega/Code/huli/manager-web/src/library/Payment/Customer/Source.php","root":{"kind":0,"name":"","children":[{"kind":512,"name":"Payment\\Customer","location":[11,0,11,27]},{"kind":1,"name":"ICommunication","modifiers":4096,"location":[13,5,13,33],"associated":[{"kind":1,"name":"Communication\\ICommunication"}]},{"kind":1,"name":"TCommunication","modifiers":4096,"location":[14,5,14,33],"associated":[{"kind":1,"name":"Communication\\TCommunication"}]},{"kind":1,"name":"ISession","modifiers":4096,"location":[15,5,15,33],"associated":[{"kind":1,"name":"Huli\\Authentication\\ISession"}]},{"kind":1,"name":"Error","modifiers":4096,"location":[16,5,16,15],"associated":[{"kind":1,"name":"Kima\\Error"}]},{"kind":1,"name":"UserSubscriptionModel","modifiers":4096,"location":[17,5,17,53],"associated":[{"kind":1,"name":"Model\\User\\Subscription"}]},{"kind":1,"name":"IProcessor","modifiers":4096,"location":[18,5,18,23],"associated":[{"kind":1,"name":"Payment\\IProcessor"}]},{"kind":1,"name":"Payment\\Customer\\Source","modifiers":8,"location":[27,0,176,1],"associated":[{"kind":2,"name":"Communication\\ICommunication"},{"kind":4,"name":"Communication\\TCommunication"}],"description":"Provides has_card detection and manipulation based on several sources: Stripe and DB\n\nTwo methods are provided:\n- sync_has_card: use DB value as reference, when has_card=false then sync with Stripe status\n- force_has_card: force DB value to has_card=true without using Stripe status","children":[{"kind":16,"name":"$session","modifiers":4,"location":[36,12,36,20],"scope":"Payment\\Customer\\Source","type":"Huli\\Authentication\\ISession"},{"kind":32,"name":"__construct","modifiers":1,"location":[41,4,44,5],"scope":"Payment\\Customer\\Source","children":[{"kind":128,"name":"$session","location":[41,32,41,49],"description":"modifier session","scope":"__construct","typeSource":1,"type":"Huli\\Authentication\\ISession"}]},{"kind":32,"name":"sync_has_card","modifiers":1,"location":[59,4,91,5],"description":"Sync user subscription has_cards status with Stripe\nand notify intercom about payment method changes","scope":"Payment\\Customer\\Source","type":"bool","children":[{"kind":128,"name":"$id_user","location":[60,8,60,16],"scope":"sync_has_card","type":"int"},{"kind":128,"name":"$processor","location":[61,8,61,29],"description":"payment processor","scope":"sync_has_card","typeSource":1,"type":"Payment\\IProcessor"},{"kind":128,"name":"$sub","location":[62,8,62,41],"description":"specify subscription to process\n","scope":"sync_has_card","value":"null","typeSource":1,"type":"Model\\User\\Subscription"}]},{"kind":32,"name":"force_has_card","modifiers":1,"location":[101,4,112,5],"description":"Force db.has_card=true\nThs method doesn't depend on a IProcessor","scope":"Payment\\Customer\\Source","type":"Model\\User\\Subscription","children":[{"kind":128,"name":"$id_user","location":[101,35,101,43],"scope":"force_has_card","type":"int"}]},{"kind":32,"name":"load_subscription","modifiers":4,"location":[121,4,124,5],"description":"Load subscription model filtered by user id","scope":"Payment\\Customer\\Source","type":"Model\\User\\Subscription","children":[{"kind":128,"name":"$id_user","location":[121,39,121,47],"scope":"load_subscription","type":"int"}]},{"kind":32,"name":"mark_subscription_has_card","modifiers":4,"location":[133,4,140,5],"description":"Manipulates UserSubscriptionModel model","scope":"Payment\\Customer\\Source","type":"Model\\User\\Subscription","children":[{"kind":128,"name":"$sub","location":[133,48,133,74],"description":"record to modify\n","scope":"mark_subscription_has_card","typeSource":1,"type":"Model\\User\\Subscription"}]},{"kind":32,"name":"notify_has_card_status","modifiers":4,"location":[148,4,156,5],"description":"Notify has card changes over communication handler","scope":"Payment\\Customer\\Source","children":[{"kind":128,"name":"$id_user","location":[148,44,148,52],"scope":"notify_has_card_status","type":"int"},{"kind":128,"name":"$has_card","location":[148,54,148,63],"scope":"notify_has_card_status","type":"bool"}]},{"kind":32,"name":"processor_has_card","modifiers":4,"location":[166,4,175,5],"description":"Verify at payment processor end if customer has cards","scope":"Payment\\Customer\\Source","type":"bool","children":[{"kind":128,"name":"$processor","location":[166,40,166,61],"description":"payment processor","scope":"processor_has_card","typeSource":1,"type":"Payment\\IProcessor"},{"kind":128,"name":"$id_stripe_customer","location":[166,63,166,82],"description":"customer strip id\n","scope":"processor_has_card","type":"string"}]}]}]}}