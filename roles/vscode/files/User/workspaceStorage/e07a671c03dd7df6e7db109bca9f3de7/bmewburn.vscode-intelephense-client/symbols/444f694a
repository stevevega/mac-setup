{"uri":"file:///Users/vega/Code/huli/manager-web/src/library/Payment/PaymentProcessor.php","root":{"kind":0,"name":"","children":[{"kind":512,"name":"Payment","location":[11,0,11,18]},{"kind":1,"name":"TResponse","modifiers":4096,"location":[13,5,13,22],"associated":[{"kind":1,"name":"HH\\Http\\TResponse"}]},{"kind":1,"name":"App","modifiers":4096,"location":[14,5,14,19],"associated":[{"kind":1,"name":"Kima\\Prime\\App"}]},{"kind":1,"name":"EventWrapper","modifiers":4096,"location":[15,5,15,48],"associated":[{"kind":1,"name":"Payment\\EventObject\\Wrapper"}]},{"kind":1,"name":"Coupon","modifiers":4096,"location":[16,5,16,18],"associated":[{"kind":1,"name":"Stripe\\Coupon"}]},{"kind":1,"name":"Customer","modifiers":4096,"location":[17,5,17,20],"associated":[{"kind":1,"name":"Stripe\\Customer"}]},{"kind":1,"name":"Event","modifiers":4096,"location":[18,5,18,17],"associated":[{"kind":1,"name":"Stripe\\Event"}]},{"kind":1,"name":"Invoice","modifiers":4096,"location":[19,5,19,19],"associated":[{"kind":1,"name":"Stripe\\Invoice"}]},{"kind":1,"name":"InvoiceItem","modifiers":4096,"location":[20,5,20,23],"associated":[{"kind":1,"name":"Stripe\\InvoiceItem"}]},{"kind":1,"name":"Subscription","modifiers":4096,"location":[21,5,21,24],"associated":[{"kind":1,"name":"Stripe\\Subscription"}]},{"kind":1,"name":"Token","modifiers":4096,"location":[22,5,22,17],"associated":[{"kind":1,"name":"Stripe\\Token"}]},{"kind":1,"name":"Exception","modifiers":4096,"location":[23,4,23,13],"associated":[{"kind":1,"name":"Exception"}]},{"kind":1,"name":"Payment\\PaymentProcessor","location":[25,0,772,1],"associated":[{"kind":2,"name":"Payment\\IProcessor"},{"kind":4,"name":"HH\\Http\\TResponse"}],"description":"_\n_             _ _| |_\n| |           | |_   _|\n| |___  _   _ | | |_|\n| '_  \\| | | || | | |\n| | | || |_| || | | |\n|_| |_|\\___,_||_| |_|\n\n(c) Huli Inc","children":[{"kind":1024,"name":"COUPON","modifiers":1,"location":[29,10,29,27],"scope":"Payment\\PaymentProcessor","value":"'coupon'"},{"kind":1024,"name":"DESCRIPTION","modifiers":1,"location":[30,10,30,37],"scope":"Payment\\PaymentProcessor","value":"'description'"},{"kind":1024,"name":"SOURCE","modifiers":1,"location":[31,10,31,27],"scope":"Payment\\PaymentProcessor","value":"'source'"},{"kind":1024,"name":"EMAIL","modifiers":1,"location":[32,10,32,25],"scope":"Payment\\PaymentProcessor","value":"'email'"},{"kind":1024,"name":"METADATA","modifiers":1,"location":[33,10,33,31],"scope":"Payment\\PaymentProcessor","value":"'metadata'"},{"kind":1024,"name":"PLAN","modifiers":1,"location":[34,10,34,23],"scope":"Payment\\PaymentProcessor","value":"'plan'"},{"kind":1024,"name":"TRIAL_END","modifiers":1,"location":[35,10,35,33],"scope":"Payment\\PaymentProcessor","value":"'trial_end'"},{"kind":1024,"name":"NOW","modifiers":1,"location":[36,10,36,21],"scope":"Payment\\PaymentProcessor","value":"'now'"},{"kind":1024,"name":"SUB_TRIALING","modifiers":1,"location":[38,10,38,35],"scope":"Payment\\PaymentProcessor","value":"'trialing'"},{"kind":1024,"name":"SUB_ACTIVE","modifiers":1,"location":[39,10,39,31],"scope":"Payment\\PaymentProcessor","value":"'active'"},{"kind":1024,"name":"REQUEST_TRIAL_END","modifiers":1,"location":[41,10,41,49],"scope":"Payment\\PaymentProcessor","value":"'request_trial_end'"},{"kind":1024,"name":"SAME_TRIAL_END","modifiers":1,"location":[42,10,42,43],"scope":"Payment\\PaymentProcessor","value":"'same_trial_end'"},{"kind":32,"name":"__construct","modifiers":1,"location":[44,4,50,5],"scope":"Payment\\PaymentProcessor"},{"kind":32,"name":"get_public_key","modifiers":33,"location":[57,4,61,5],"description":"Returns the public key to be used with stripe.js client library","scope":"Payment\\PaymentProcessor","type":"string"},{"kind":32,"name":"save_customer","modifiers":1,"location":[73,4,100,5],"description":"Saves the customer information","scope":"Payment\\PaymentProcessor","type":"Stripe\\Customer","children":[{"kind":128,"name":"$customer","location":[73,34,73,43],"description":"should contain all the required info to\nbe sent to the payment processor.","scope":"save_customer","type":"Stripe\\Customer"},{"kind":128,"name":"$allow_trial","location":[73,45,73,64],"description":"whether the new customer has a trial,\nenabled by default\n","scope":"save_customer","value":"true","type":"bool"}]},{"kind":32,"name":"update_customer_details","modifiers":1,"location":[110,4,123,5],"description":"Updates the customer email and description (usually the name) in Stripe","scope":"Payment\\PaymentProcessor","type":"Stripe\\Customer","children":[{"kind":128,"name":"$customer","location":[110,44,110,53],"description":"must contain the stripe customer id, name\nand email.\n","scope":"update_customer_details","type":"object"}]},{"kind":32,"name":"get_customer","modifiers":1,"location":[134,4,149,5],"description":"Retrieves the information stored in Stripe related to an\nspecific customer","scope":"Payment\\PaymentProcessor","type":"Payment\\Stripe","children":[{"kind":128,"name":"$id","location":[134,33,134,36],"description":"the customer alphanumeric id","scope":"get_customer","type":"string"},{"kind":128,"name":"$error_on_deleted","location":[134,38,134,62],"description":"verify if user was deleted\n","scope":"get_customer","value":"true","type":"bool"}]},{"kind":32,"name":"get_customer_sources","modifiers":1,"location":[159,4,168,5],"description":"Retrieve customer sources handler","scope":"Payment\\PaymentProcessor","type":"array","children":[{"kind":128,"name":"$id_customer","location":[159,41,159,53],"description":"stripe customer id\n","scope":"get_customer_sources","type":"string"}]},{"kind":32,"name":"is_valid_coupon","modifiers":1,"location":[177,4,184,5],"description":"Checks that the passed coupon exists and can be redeemed.","scope":"Payment\\PaymentProcessor","typeSource":1,"type":"bool","children":[{"kind":128,"name":"$coupon","location":[177,36,177,50],"scope":"is_valid_coupon","typeSource":1,"type":"string"}]},{"kind":32,"name":"update_customer_card","modifiers":1,"location":[197,4,222,5],"description":"Updates a customer card, only the name and expiration date can be changed","scope":"Payment\\PaymentProcessor","type":"Payment\\Stripe_Card","children":[{"kind":128,"name":"$id_customer","location":[198,8,198,20],"description":"stored stripe id","scope":"update_customer_card","type":"string"},{"kind":128,"name":"$id_card","location":[199,8,199,16],"description":"stored stripe card id","scope":"update_customer_card","type":"string"},{"kind":128,"name":"$name","location":[200,8,200,13],"description":"name on the card","scope":"update_customer_card","type":"string"},{"kind":128,"name":"$exp_month","location":[201,8,201,18],"description":"expiration month","scope":"update_customer_card","type":"int"},{"kind":128,"name":"$exp_year","location":[202,8,202,17],"description":"expiration year\n","scope":"update_customer_card","type":"int"}]},{"kind":32,"name":"get_customer_card","modifiers":1,"location":[233,4,242,5],"description":"Retrieve customer specific card","scope":"Payment\\PaymentProcessor","type":"array","children":[{"kind":128,"name":"$id_customer","location":[233,38,233,50],"description":"stripe customer id","scope":"get_customer_card","type":"string"},{"kind":128,"name":"$id_card","location":[233,52,233,60],"description":"stripe card id\n","scope":"get_customer_card","type":"string"}]},{"kind":32,"name":"get_customer_default_card","modifiers":1,"location":[253,4,262,5],"description":"Retrieve customer default card","scope":"Payment\\PaymentProcessor","type":"Payment\\Stripe_Card","children":[{"kind":128,"name":"$id_customer","location":[253,46,253,58],"description":"stripe customer id\n","scope":"get_customer_default_card","type":"string"}]},{"kind":32,"name":"set_customer_default_card","modifiers":1,"location":[270,4,281,5],"description":"Sets the card that will be charged first when a payment goes through","scope":"Payment\\PaymentProcessor","children":[{"kind":128,"name":"$id_customer","location":[270,46,270,58],"description":"stripe customer id","scope":"set_customer_default_card","type":"string"},{"kind":128,"name":"$id_card","location":[270,60,270,68],"description":"stripe card id","scope":"set_customer_default_card","type":"string"}]},{"kind":32,"name":"add_customer_card","modifiers":1,"location":[289,4,298,5],"description":"Adds a new card for the customer","scope":"Payment\\PaymentProcessor","children":[{"kind":128,"name":"$id_customer","location":[289,38,289,50],"description":"stored stripe id","scope":"add_customer_card","type":"string"},{"kind":128,"name":"$token","location":[289,52,289,58],"description":"the credit card token returned by stripe.js","scope":"add_customer_card","type":"string"}]},{"kind":32,"name":"delete_customer_card","modifiers":1,"location":[308,4,317,5],"description":"Deletes the customer card information","scope":"Payment\\PaymentProcessor","type":"bool","children":[{"kind":128,"name":"$id_customer","location":[308,41,308,53],"description":"stripe customer id","scope":"delete_customer_card","type":"string"},{"kind":128,"name":"$id_card","location":[308,55,308,63],"description":"stripe card id\n","scope":"delete_customer_card","type":"string"}]},{"kind":32,"name":"delete_customer","modifiers":1,"location":[326,4,335,5],"description":"Delete the customer by id","scope":"Payment\\PaymentProcessor","type":"mixed","children":[{"kind":128,"name":"$id_customer","location":[326,36,326,48],"description":"the stripe customer id (alphanumeric)\n","scope":"delete_customer","type":"string"}]},{"kind":32,"name":"get_customer_past_charges","modifiers":1,"location":[345,4,353,5],"description":"Retrieves all the charges that have been made to a customer","scope":"Payment\\PaymentProcessor","type":"array","children":[{"kind":128,"name":"$id_customer","location":[345,46,345,58],"description":"Stripe customer id","scope":"get_customer_past_charges","type":"string"},{"kind":128,"name":"$limit","location":[345,60,345,66],"description":"the number of results to retrieve\n","scope":"get_customer_past_charges","type":"int"}]},{"kind":32,"name":"get_customer_cards","modifiers":1,"location":[362,4,367,5],"description":"Gets all the customer cards information","scope":"Payment\\PaymentProcessor","type":"array","children":[{"kind":128,"name":"$id_customer","location":[362,39,362,51],"description":"stripe customer id\n","scope":"get_customer_cards","type":"string"}]},{"kind":32,"name":"get_event","modifiers":1,"location":[376,4,381,5],"description":"Retrieves the event information","scope":"Payment\\PaymentProcessor","type":"Payment\\IEventObject","children":[{"kind":128,"name":"$id_event","location":[376,30,376,39],"scope":"get_event","type":"string"}]},{"kind":32,"name":"update_customer_plan","modifiers":1,"location":[394,4,431,5],"description":"Updates the customer subscription information, namely the current plan","scope":"Payment\\PaymentProcessor","type":"array","children":[{"kind":128,"name":"$id_customer","location":[395,8,395,20],"description":"Stripe customer id","scope":"update_customer_plan","type":"string"},{"kind":128,"name":"$plan","location":[396,8,396,13],"description":"new plan id or name","scope":"update_customer_plan","type":"string"},{"kind":128,"name":"$trial_end","location":[397,8,397,53],"description":"trial end date (default: PaymentProcessor::SAME_TRIAL_END)","scope":"update_customer_plan","value":"PaymentProcessor::SAME_TRIAL_END","type":"mixed"},{"kind":128,"name":"$is_change_to_free","location":[398,8,398,34],"description":"avoid prorating on downgrade to free plan (default: false)\n","scope":"update_customer_plan","value":"false","type":"bool"}]},{"kind":32,"name":"update_customer_trial","modifiers":1,"location":[441,4,464,5],"description":"Updates the customer subscription trial end date","scope":"Payment\\PaymentProcessor","type":"Stripe\\Subscription","children":[{"kind":128,"name":"$id_customer","location":[441,42,441,54],"description":"Stripe customer id","scope":"update_customer_trial","type":"string"},{"kind":128,"name":"$trial_end","location":[441,56,441,66],"description":"new trial end date\n","scope":"update_customer_trial","type":"string"}]},{"kind":32,"name":"cancel_subscription","modifiers":1,"location":[469,4,486,5],"scope":"Payment\\PaymentProcessor","children":[{"kind":128,"name":"$id","location":[469,40,469,43],"scope":"cancel_subscription"}]},{"kind":32,"name":"create_token","modifiers":1,"location":[499,4,504,5],"description":"Creates an Stripe Token, this method should be used ONLY FOR TESTING\nin order to comply with PCI standards i.e. when mustn't store/transmit\nany credit card info.","scope":"Payment\\PaymentProcessor","type":"Stripe\\Token","children":[{"kind":128,"name":"$card","location":[499,33,499,38],"description":"contains the card information\n","scope":"create_token","type":"array"}]},{"kind":32,"name":"get_token","modifiers":1,"location":[516,4,521,5],"description":"Retrieves the token. in our case with a card associated, that\nhas various PCI compliant details.","scope":"Payment\\PaymentProcessor","type":"Stripe\\Token","children":[{"kind":128,"name":"$id_token","location":[516,30,516,39],"description":"stripe token\n","scope":"get_token","type":"string"}]},{"kind":32,"name":"create_invoice","modifiers":1,"location":[533,4,540,5],"description":"Creates a new invoice for a given customer.\n\nImportant: This invoice will sweep any invoice item not associated to\na given subscription and include them in the invoice.","scope":"Payment\\PaymentProcessor","type":"Stripe\\Invoice","children":[{"kind":128,"name":"$id_customer","location":[533,35,533,47],"description":"stripe customer id\n","scope":"create_invoice","type":"string"}]},{"kind":32,"name":"get_invoices","modifiers":1,"location":[550,4,557,5],"description":"Get all invoices, including different statuses: paid-unpaid-close-forgiven\nBy default, Stripe returns only the 10 most recent invoices","scope":"Payment\\PaymentProcessor","type":"Stripe\\Invoice[]","children":[{"kind":128,"name":"$id_customer","location":[550,33,550,45],"description":"stripe customer id\n","scope":"get_invoices","type":"string"}]},{"kind":32,"name":"get_invoice","modifiers":1,"location":[566,4,571,5],"description":"Gets a specific invoice using the id provided.","scope":"Payment\\PaymentProcessor","type":"Stripe\\Invoice","children":[{"kind":128,"name":"$id","location":[566,32,566,42],"description":"invoice id formatted \"ii_XXXXXXXXXXXXX\"\n","scope":"get_invoice","typeSource":1,"type":"string"}]},{"kind":32,"name":"forgive_invoice","modifiers":1,"location":[583,4,596,5],"description":"Forgive invoice\n- This is different than CLOSE invoice\n- A forgiven invoice is deducted from account balance","scope":"Payment\\PaymentProcessor","type":"Stripe\\Invoice","children":[{"kind":128,"name":"$invoice","location":[583,36,583,52],"scope":"forgive_invoice","typeSource":1,"type":"Stripe\\Invoice"},{"kind":128,"name":"$description","location":[583,54,583,73],"scope":"forgive_invoice","value":"null","type":"null|mixed"}]},{"kind":32,"name":"add_line_item","modifiers":1,"location":[606,4,622,5],"description":"Adds a invoice line item for a given customer, this line item represents\nan extra/additional charge that should be made to customer in the next\nbilling cycle of in the provided subscription or invoice.","scope":"Payment\\PaymentProcessor","children":[{"kind":128,"name":"$line_item","location":[606,34,606,44],"description":"should contain the fields, id_customer (stripe\nformat), amount (int) , description (string)","scope":"add_line_item","type":"object"}]},{"kind":32,"name":"resolve_trial_end","modifiers":4,"location":[632,4,674,5],"description":"Resolve trial_end subscription param for customer plan update","scope":"Payment\\PaymentProcessor","type":"Stripe\\Subscription","children":[{"kind":128,"name":"$subscription","location":[632,39,632,52],"scope":"resolve_trial_end","type":"Stripe\\Subscription"},{"kind":128,"name":"$trial_end","location":[632,54,632,64],"scope":"resolve_trial_end","type":"string"}]},{"kind":32,"name":"post_process_plan_change","modifiers":4,"location":[690,4,721,5],"description":"Checks the subscription and when it's active it will create an invoice\nthat will sweep all pending invoice items and charge the user right away.\n\nNote, that if you try to update plans with different billing cycle, i.e.\nmonthly vs weekly this function will fail with a \"No pending invoce items\"\nerror because Stripe will automatically create an invoice in the case of\nplan changes with different billing cycles.","scope":"Payment\\PaymentProcessor","type":"Stripe\\Invoice","children":[{"kind":128,"name":"$id_customer","location":[690,46,690,58],"description":"stripe customer id","scope":"post_process_plan_change","type":"string"},{"kind":128,"name":"$id_subscription","location":[690,60,690,76],"description":"stripe customer subscription\n","scope":"post_process_plan_change","type":"string"}]},{"kind":32,"name":"format_amount","modifiers":4,"location":[731,4,734,5],"description":"Formats the amount to an int in cents value as this is the way Stripe\nprocesses them","scope":"Payment\\PaymentProcessor","type":"int","children":[{"kind":128,"name":"$amount","location":[731,35,731,42],"scope":"format_amount","type":"Payment\\number"}]},{"kind":32,"name":"execute_processor_call","modifiers":4,"location":[745,4,771,5],"description":"Executes the API request to the payment processor and guards against\nevent exceptions","scope":"Payment\\PaymentProcessor","type":"mixed","children":[{"kind":128,"name":"$process","location":[745,44,745,52],"description":"the function to be executed","scope":"execute_processor_call","type":"callable"},{"kind":128,"name":"$arguments","location":[745,54,745,71],"description":"the arguments to be passed to the callable object\n","scope":"execute_processor_call","value":"null","type":"object"}]}]}]}}