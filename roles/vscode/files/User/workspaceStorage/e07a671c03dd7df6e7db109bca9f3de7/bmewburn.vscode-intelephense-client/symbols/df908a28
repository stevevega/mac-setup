{"uri":"file:///Users/vega/Code/huli/manager-web/src/library/HH/Subscription/Flow/Unsubscribe.php","root":{"kind":0,"name":"","children":[{"kind":512,"name":"HH\\Subscription\\Flow","location":[11,0,11,31]},{"kind":1,"name":"ICommunication","modifiers":4096,"location":[13,5,13,33],"associated":[{"kind":1,"name":"Communication\\ICommunication"}]},{"kind":1,"name":"TCommunication","modifiers":4096,"location":[14,5,14,33],"associated":[{"kind":1,"name":"Communication\\TCommunication"}]},{"kind":1,"name":"OrgAccount","modifiers":4096,"location":[15,5,15,54],"associated":[{"kind":1,"name":"HH\\Entity\\Organization\\User\\Account"}]},{"kind":1,"name":"TResponse","modifiers":4096,"location":[16,5,16,22],"associated":[{"kind":1,"name":"HH\\Http\\TResponse"}]},{"kind":1,"name":"Trial","modifiers":4096,"location":[17,5,17,26],"associated":[{"kind":1,"name":"HH\\Subscription\\Trial"}]},{"kind":1,"name":"ISession","modifiers":4096,"location":[18,5,18,33],"associated":[{"kind":1,"name":"Huli\\Authentication\\ISession"}]},{"kind":1,"name":"AuthOrg","modifiers":4096,"location":[19,5,19,47],"associated":[{"kind":1,"name":"Huli\\Authorization\\Organization"}]},{"kind":1,"name":"Date","modifiers":4096,"location":[20,5,20,19],"associated":[{"kind":1,"name":"Huli\\Util\\Date"}]},{"kind":1,"name":"UserSubscriptionModel","modifiers":4096,"location":[21,5,21,53],"associated":[{"kind":1,"name":"Model\\User\\Subscription"}]},{"kind":1,"name":"IProcessor","modifiers":4096,"location":[22,5,22,23],"associated":[{"kind":1,"name":"Payment\\IProcessor"}]},{"kind":1,"name":"HH\\Subscription\\Flow\\Unsubscribe","location":[39,0,355,1],"associated":[{"kind":2,"name":"HH\\Subscription\\Flow\\IFlow"},{"kind":2,"name":"Communication\\ICommunication"},{"kind":4,"name":"HH\\Http\\TResponse"},{"kind":4,"name":"Communication\\TCommunication"}],"description":"Subscriptions flow: UNSUBSCRIBE\n\nCancel subscription and terminate user account depending on the different\nconstraints in the user account. Use this flow when you need to cancel an\naccount, all the business rules should be here for that case.\n\n- Free accounts and accounts whose trial has expired are terminate right away.\n- Accounts with a trial will be terminated once the trial period ends.\n- Paying accounts are terminated according to their billing period.\n- Manual accounts are terminated based on the value set by the user (admin).\n\nNo differences for user with SaaS instances. Only supports unsubscription\nfor doctor users.","children":[{"kind":1024,"name":"ERROR_CUST_NOT_FOUND","modifiers":1,"location":[44,10,44,72],"scope":"HH\\Subscription\\Flow\\Unsubscribe","value":"'error_customer_not_found_in_processor'"},{"kind":1024,"name":"ERROR_CUST_NO_SUB","modifiers":1,"location":[45,10,45,64],"scope":"HH\\Subscription\\Flow\\Unsubscribe","value":"'error_sub_not_found_in_processor'"},{"kind":1024,"name":"ERROR_ALREADY_UNSUB","modifiers":1,"location":[46,10,46,62],"scope":"HH\\Subscription\\Flow\\Unsubscribe","value":"'error_already_unsuscribed %s'"},{"kind":16,"name":"$params","modifiers":4,"location":[53,12,53,19],"scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"mixed"},{"kind":16,"name":"$session","modifiers":4,"location":[60,12,60,20],"scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"Huli\\Authentication\\ISession"},{"kind":16,"name":"$flow","modifiers":4,"location":[68,12,68,17],"scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"HH\\Subscription\\Flow\\IFlow"},{"kind":16,"name":"$expire","modifiers":4,"location":[76,12,76,27],"scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"bool"},{"kind":16,"name":"$pay_proc","modifiers":4,"location":[83,12,83,21],"scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"Payment\\IProcessor"},{"kind":16,"name":"$reload","modifiers":4,"location":[90,12,90,27],"scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"bool"},{"kind":32,"name":"__construct","modifiers":1,"location":[104,4,109,5],"description":"Flow constructor as setup","scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"HH\\Subscription\\Flow\\Unsubscribe","children":[{"kind":128,"name":"$session","location":[104,32,104,49],"scope":"__construct","typeSource":1,"type":"Huli\\Authentication\\ISession"},{"kind":128,"name":"$params","location":[104,51,104,58],"description":"setup params\n- id_user             int      doctor user id\n- reason_key          string\n- reason_text         string","scope":"__construct","type":"object"},{"kind":128,"name":"$pay_proc","location":[104,60,104,80],"description":"the payment processor facade\n","scope":"__construct","typeSource":1,"type":"Payment\\IProcessor"}]},{"kind":32,"name":"execute","modifiers":1,"location":[117,4,172,5],"description":"Will either terminate the subscription right away or delay the termination\nuntil the billing period end depending on the subscription status.","scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"bool"},{"kind":32,"name":"is_reload","modifiers":1,"location":[179,4,182,5],"description":"Retrieves the value of the flag \"reload\"","scope":"HH\\Subscription\\Flow\\Unsubscribe","typeSource":1,"type":"bool"},{"kind":32,"name":"get_orgs_names","modifiers":1,"location":[189,4,200,5],"description":"Retrieves the name of all the organization that the user belongs","scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"array"},{"kind":32,"name":"get_plan","modifiers":1,"location":[207,4,210,5],"description":"Retrieves the name of the plan of the doctor","scope":"HH\\Subscription\\Flow\\Unsubscribe","typeSource":1,"type":"string"},{"kind":32,"name":"notify","modifiers":1,"location":[215,4,218,5],"scope":"HH\\Subscription\\Flow\\Unsubscribe"},{"kind":32,"name":"requires_expiration","modifiers":1,"location":[226,4,229,5],"description":"Returns whether the flow chosen might need a session invalidation. Use\nthis when you need to know that the client must receive an logout signal.","scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"bool"},{"kind":32,"name":"load_sub","modifiers":4,"location":[236,4,250,5],"description":"Loads the subscription information needed for this flow.","scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"Model\\User\\Subscription"},{"kind":32,"name":"get_current_period_end","modifiers":4,"location":[260,4,276,5],"description":"Retrieves the customer object from the payment processor and looks\nfor the period end of the current subscription.","scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"int|null","children":[{"kind":128,"name":"$sub","location":[260,44,260,70],"scope":"get_current_period_end","typeSource":1,"type":"Model\\User\\Subscription"}]},{"kind":32,"name":"is_instant","modifiers":4,"location":[287,4,305,5],"description":"Returns whether the unsubcription should be done instantly instead\nof waiting for some time before cancelling the account.","scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"bool","children":[{"kind":128,"name":"$sub","location":[287,32,287,58],"scope":"is_instant","typeSource":1,"type":"Model\\User\\Subscription"},{"kind":128,"name":"$t","location":[287,60,287,68],"scope":"is_instant","typeSource":1,"type":"HH\\Subscription\\Trial"}]},{"kind":32,"name":"has_cards","modifiers":4,"location":[319,4,332,5],"description":"Returns whether the subscription has any card associated.\n\nIf the sub is manual or lacks a stripe id it defaults to false, otherwise\nit checks the remote processor for sources.","scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"bool","children":[{"kind":128,"name":"$sub","location":[319,31,319,57],"scope":"has_cards","typeSource":1,"type":"Model\\User\\Subscription"}]},{"kind":32,"name":"get_pay_proc_customer","modifiers":4,"location":[341,4,354,5],"description":"Retrieves the customer data from the payment processor.","scope":"HH\\Subscription\\Flow\\Unsubscribe","type":"HH\\Subscription\\Flow\\Object","children":[{"kind":128,"name":"$sub","location":[341,43,341,69],"scope":"get_pay_proc_customer","typeSource":1,"type":"Model\\User\\Subscription"}]}]}]}}