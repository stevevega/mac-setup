{"uri":"file:///Users/vega/Code/huli/manager-web/src/library/HH/Util/Script/SMSMessage/AlternativeContactsReminder.php","root":{"kind":0,"name":"","children":[{"kind":512,"name":"HH\\Util\\Script\\SMSMessage","location":[11,0,11,36]},{"kind":1,"name":"AppointmentStatus","modifiers":4096,"location":[13,5,13,62],"associated":[{"kind":1,"name":"HH\\Calendar\\Event\\Appointment\\Status"}]},{"kind":1,"name":"HHInstance","modifiers":4096,"location":[14,5,14,30],"associated":[{"kind":1,"name":"HH\\Instance"}]},{"kind":1,"name":"Status","modifiers":4096,"location":[15,5,15,14],"associated":[{"kind":1,"name":"HH\\Status"}]},{"kind":1,"name":"PhoneUtil","modifiers":4096,"location":[16,5,16,34],"associated":[{"kind":1,"name":"HH\\UI\\Util\\Phone"}]},{"kind":1,"name":"Date","modifiers":4096,"location":[17,5,17,17],"associated":[{"kind":1,"name":"HH\\Util\\Date"}]},{"kind":1,"name":"Gender","modifiers":4096,"location":[18,5,18,30],"associated":[{"kind":1,"name":"Huli\\Enum\\Listable\\Gender"}]},{"kind":1,"name":"AddonEnum","modifiers":4096,"location":[19,5,19,37],"associated":[{"kind":1,"name":"Huli\\Enum\\Set\\Addon"}]},{"kind":1,"name":"L10n","modifiers":4096,"location":[20,5,20,14],"associated":[{"kind":1,"name":"Kima\\L10n"}]},{"kind":1,"name":"AppointmentModel","modifiers":4096,"location":[21,5,21,42],"associated":[{"kind":1,"name":"Model\\Appointment"}]},{"kind":1,"name":"OrganizationAddonModel","modifiers":4096,"location":[22,5,22,55],"associated":[{"kind":1,"name":"Model\\Organization\\Addon"}]},{"kind":1,"name":"OrganizationMessage","modifiers":4096,"location":[23,5,23,54],"associated":[{"kind":1,"name":"Model\\Organization\\Message"}]},{"kind":1,"name":"Nexmo","modifiers":4096,"location":[24,5,24,22],"associated":[{"kind":1,"name":"Phone\\Relay\\Nexmo"}]},{"kind":1,"name":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","location":[37,0,437,1],"description":"Appointment SMS reminder class for alternative contacts\nThe sms message will be saved on:\n1. The message was send correctly\n2. The message wasn't send correctly but no retry is needed\n3. Is the last retry\n\nDoctor timezone can be a problem because is different from user to user\nOnly to mobile phone will be send messages\nThe SMS provider will be chosen based on the country of the phone","children":[{"kind":1024,"name":"DAY_OFFSET","modifiers":1,"location":[42,10,42,24],"scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","value":"1"},{"kind":1024,"name":"MAX_RETRY","modifiers":1,"location":[47,10,47,23],"scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","value":"3"},{"kind":1024,"name":"SECONDS","modifiers":1,"location":[52,10,52,23],"scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","value":"0.3"},{"kind":1024,"name":"HOURS_OFF_SET","modifiers":1,"location":[58,10,58,28],"scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","value":"24"},{"kind":16,"name":"$max_retry","modifiers":4,"location":[65,12,65,22],"scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","type":"bool"},{"kind":16,"name":"$seconds","modifiers":4,"location":[72,12,72,20],"scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","type":"bool"},{"kind":16,"name":"$pending_messages","modifiers":4,"location":[77,12,77,36],"scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder"},{"kind":16,"name":"$script_controller","modifiers":4,"location":[82,12,82,30],"scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder"},{"kind":16,"name":"$mock_provider","modifiers":4,"location":[89,12,89,26],"scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","type":"HH\\Util\\Script\\SMSMessage\\Mock"},{"kind":16,"name":"$seconds_to_sleep_on_retry","modifiers":4,"location":[96,12,96,43],"scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","type":"int"},{"kind":32,"name":"__construct","modifiers":1,"location":[103,4,106,5],"description":"Appointment reminder controller","scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","children":[{"kind":128,"name":"$script_controller","location":[103,32,103,50],"scope":"__construct","type":"object"}]},{"kind":32,"name":"start","modifiers":1,"location":[115,4,152,5],"description":"Start the appointment reminder process","scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","children":[{"kind":128,"name":"$max_retry","location":[115,26,115,36],"scope":"start","type":"int"},{"kind":128,"name":"$seconds","location":[115,38,115,46],"scope":"start","type":"int"},{"kind":128,"name":"$hours_off_set","location":[115,48,115,62],"scope":"start","type":"mixed"}]},{"kind":32,"name":"set_mock_provider","modifiers":1,"location":[160,4,165,5],"description":"The relay provider is choosen for each sms provider\nThis function is used for testing purposes to inject a mock relay provider","scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","children":[{"kind":128,"name":"$mock_provider","location":[160,38,160,52],"scope":"set_mock_provider","type":"HH\\Util\\Script\\SMSMessage\\Mock"}]},{"kind":32,"name":"set_retry_sleep_time","modifiers":1,"location":[172,4,177,5],"description":"Set the seconds to wait on a retry","scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","children":[{"kind":128,"name":"$seconds_to_sleep_on_retry","location":[172,41,172,67],"scope":"set_retry_sleep_time","type":"int"}]},{"kind":32,"name":"process_sms_messages","modifiers":4,"location":[186,4,203,5],"description":"Process each of the doctors batch(each batch belongs to a different timezone)","scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","children":[{"kind":128,"name":"$doctors","location":[186,42,186,56],"scope":"process_sms_messages","type":"array"},{"kind":128,"name":"$start_date","location":[186,58,186,69],"scope":"process_sms_messages","type":"string"},{"kind":128,"name":"$hour","location":[186,71,186,76],"scope":"process_sms_messages","type":"int"}]},{"kind":32,"name":"send_reminders","modifiers":4,"location":[216,4,283,5],"description":"Send the SMS message reminders","scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","type":"bool","children":[{"kind":128,"name":"$doctors","location":[216,36,216,50],"scope":"send_reminders","type":"array"},{"kind":128,"name":"$retry_count","location":[216,52,216,64],"description":"count the number of the retry","scope":"send_reminders","type":"int"},{"kind":128,"name":"$start_date","location":[216,66,216,77],"scope":"send_reminders","type":"string"},{"kind":128,"name":"$hour","location":[216,79,216,84],"scope":"send_reminders","type":"int"}]},{"kind":32,"name":"get_appointment_to_send","modifiers":4,"location":[295,4,325,5],"description":"Get all the appointment reminder to be send","scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","type":"array","children":[{"kind":128,"name":"$doctors","location":[295,45,295,59],"scope":"get_appointment_to_send","type":"array"},{"kind":128,"name":"$start_date","location":[295,61,295,79],"scope":"get_appointment_to_send","typeSource":1,"type":"string"},{"kind":128,"name":"$hour","location":[295,81,295,93],"scope":"get_appointment_to_send","typeSource":1,"type":"string"}]},{"kind":32,"name":"get_provider","modifiers":4,"location":[334,4,348,5],"description":"Get the sms message relay based on the country of the phone","scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","type":"HH\\Util\\Script\\SMSMessage\\IProvider","children":[{"kind":128,"name":"$id_country","location":[334,34,334,45],"description":"country of the patient phone\n","scope":"get_provider","type":"int"}]},{"kind":32,"name":"get_doctors","modifiers":4,"location":[355,4,377,5],"description":"Get the doctor with sms functionality enabled","scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","type":"array"},{"kind":32,"name":"get_sms_message","modifiers":4,"location":[387,4,423,5],"description":"Get the sms text to be send to the patient","scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","type":"string","children":[{"kind":128,"name":"$appointment","location":[387,37,387,49],"scope":"get_sms_message","type":"object"},{"kind":128,"name":"$doctor","location":[387,51,387,58],"scope":"get_sms_message","type":"object"}]},{"kind":32,"name":"get_phone_number","modifiers":4,"location":[433,4,436,5],"description":"Get patient ice contact phone number","scope":"HH\\Util\\Script\\SMSMessage\\AlternativeContactsReminder","type":"string","children":[{"kind":128,"name":"$appointment","location":[433,38,433,50],"scope":"get_phone_number","type":"mixed"}]}]}]}}